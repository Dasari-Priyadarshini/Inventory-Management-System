<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Categories</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
      body{background:#0b1022}
      header{display:none}
      .app{display:grid;grid-template-columns:240px 1fr;min-height:100vh}
      .sidebar{background:#0f1630;border-right:1px solid #1d2a52;padding:20px;position:sticky;top:0;height:100vh}
      .brand{color:#c8d7ff;font-weight:800;letter-spacing:.4px;margin-bottom:16px}
      .menu{display:flex;flex-direction:column;gap:8px}
      .menu a{color:#a9b8e8;text-decoration:none;padding:10px 12px;border-radius:8px}
      .menu a.active,.menu a:hover{background:#172349;color:#e7f1ff}
      .content{padding:20px}
      .page-title{font-size:28px;margin:0 0 14px;color:#e7f1ff}
      .grid{display:grid;grid-template-columns:360px 1fr;gap:12px}
      @media(max-width:900px){.app{grid-template-columns:1fr}.sidebar{position:relative;height:auto}.grid{grid-template-columns:1fr}}
      .card.white{background:#111a35;border-radius:12px;border:1px solid #1d2a52;padding:16px;box-shadow:0 8px 18px rgba(0,0,0,.2);color:#dbe8ff}
      .muted{color:#9fb4db}
      .row{display:flex;gap:10px;margin-bottom:10px}
      .row.actions{justify-content:flex-start}
      .row input{flex:1}
      .flex{display:flex;gap:10px;align-items:center}
      .right{margin-left:auto}
      table{width:100%}
      th, td{padding:10px}
      .actions-cell a.link{color:#2563eb;text-decoration:none;margin-right:12px}
      .actions-cell a.link.danger{color:#ef4444}
      .searchbar{margin-bottom:10px}
    </style>
  </head>
  <body>
    <div class="app">
      <aside class="sidebar">
        <div class="brand">Inventory MS</div>
        <nav class="menu">
          <a href="dashboard.html">Dashboard</a>
          <a href="products.html">Products</a>
          <a class="active" href="categories.html">Categories</a>
          <a href="admin-orders.html">Orders</a>
          <a href="suppliers.html">Suppliers</a>
          <a href="users.html">Users</a>
          <a href="profile.html">Profile</a>
          <a class="logout" href="index.html">Logout</a>
        </nav>
      </aside>
      <main class="content">
        <h1 class="page-title">Category Management</h1>
        <div class="grid">
          <div class="card white">
            <h3 style="margin:0 0 8px">Add New Category</h3>
            <form id="form">
              <div class="row"><input name="name" placeholder="Category Name" required></div>
              <div class="row actions">
                <button class="primary" type="submit">Add Category</button>
                <button type="button" id="btn-cancel" style="display:none">Cancel</button>
              </div>
            </form>
          </div>
          <div>
            <div class="card white">
              <div class="flex searchbar">
                <input id="search" placeholder="Search categories...">
                <button class="primary" id="btn-search">Search</button>
                <div class="right"></div>
              </div>
              <div style="overflow:auto">
                <table>
                  <thead>
                    <tr><th style="width:80px">ID</th><th>Name</th><th style="width:140px">Actions</th></tr>
                  </thead>
                  <tbody id="rows"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      const rows = document.getElementById('rows');
      const form = document.getElementById('form');
      const btnCancel = document.getElementById('btn-cancel');
      let editingId = null;

      const LocalCategories = {
        _key: 'ims_categories',
        _read(){ try { return JSON.parse(localStorage.getItem(this._key)||'[]')||[] } catch(e){ return [] } },
        _write(list){ localStorage.setItem(this._key, JSON.stringify(list)); },
        async list(q){ const list=this._read(); if(!q) return list; const s=String(q).toLowerCase(); return list.filter(c=>String(c.name||'').toLowerCase().includes(s)); },
        async get(id){ return this._read().find(c=>String(c.id)===String(id)); },
        async create(data){ const list=this._read(); const id=Date.now().toString(); const c={id, ...data}; list.push(c); this._write(list); return c; },
        async update(id, data){ const list=this._read(); const i=list.findIndex(c=>String(c.id)===String(id)); if(i>-1){ list[i] = { ...list[i], ...data, id: list[i].id }; this._write(list); return list[i]; } throw new Error('Not found'); },
        async remove(id){ const list=this._read().filter(c=>String(c.id)!==String(id)); this._write(list); return { ok:true }; }
      };
      const Store = LocalCategories;

      async function load(q){
        const list = await Store.list(q);
        rows.innerHTML = '';
        list.forEach((c, idx)=>{
          const tr=document.createElement('tr');
          tr.innerHTML = `<td>${idx+1}</td><td>${c.name}</td><td class="actions-cell"><a href="#" class="link" data-edit="${c.id}">Edit</a><a href="#" class="link danger" data-del="${c.id}">Delete</a></td>`;
          rows.appendChild(tr);
        });
      }

      document.getElementById('btn-search').onclick = () => load(document.getElementById('search').value);

      rows.addEventListener('click', async (e)=>{
        if(e.target.dataset.edit){
          const c = await Store.get(e.target.dataset.edit);
          editingId = c.id;
          form.name.value = c.name || '';
          btnCancel.style.display = 'inline-block';
          form.querySelector('button.primary').textContent = 'Save';
        }
        if(e.target.dataset.del){
          if(confirm('Delete category?')){
            try{ await Store.remove(e.target.dataset.del); load(); }catch(err){ alert(err.message||'Delete failed'); }
          }
        }
      });

      btnCancel.onclick = () => {
        editingId = null;
        form.reset();
        btnCancel.style.display = 'none';
        form.querySelector('button.primary').textContent = 'Add Category';
      };

      form.onsubmit = async (e) => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(form).entries());
        try{
          if(editingId){ await Store.update(editingId, data); }
          else{ await Store.create(data); }
          btnCancel.click();
          load();
        }catch(err){ alert(err.message||'Save failed'); }
      };

      load();
    </script>
  </body>
</html>
